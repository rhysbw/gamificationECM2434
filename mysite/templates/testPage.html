<!DOCTYPE html>
<html>
<head>
  <title>Get Location</title>
</head>
<body>
  <p>Latitude: <span id="latitude"></span></p>
  <p>Longitude: <span id="longitude"></span></p>

  <script>


    const targetLatitude = 50.73078;
    const targetLongitude = -3.51056;
    const maxDistance = 50; // meters

    function distance(position, targetLat, targetLng) {
      const R = 6371000; // Earth's radius in meters
      const lat1 = position.coords.latitude;
      const lng1 = position.coords.longitude;
      const lat2 = targetLat;
      const lng2 = targetLng;
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLng = (lng2 - lng1) * Math.PI / 180;
      const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLng / 2) * Math.sin(dLng / 2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      const distance = R * c;
      alert(distance);
      return distance;
    }

    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.watchPosition(checkLocation, handleError);
      } else {
          alert("Geolocation is not supported by this browser.");
      }
    }

    function checkLocation(position) {
        if (distance(position, {{ lat }}, {{ long }}) <= maxDistance) {
            alert('in range')
        } else {
            alert('bum bum poop')
        }
      document.getElementById('latitude').innerHTML = position.coords.latitude;
      document.getElementById('longitude').innerHTML = position.coords.longitude;
    }

    function handleError(error) {
      switch(error.code) {
        case error.PERMISSION_DENIED:
            document.getElementById('latitude').innerHTML = "failed to get position";
            document.getElementById('longitude').innerHTML = "failed to get position";

          alert("User denied the request for Geolocation.");
          break;
        case error.POSITION_UNAVAILABLE:
          alert("Location information is unavailable.");
          break;
        case error.TIMEOUT:
          alert("The request to get user location timed out.");
          break;
      }
    }

    getLocation()

  </script>
</body>
</html>
